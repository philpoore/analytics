define(function(){var e=function(){function e(e){void 0!==e&&"object"==typeof e&&(void 0!==e.before&&"function"==typeof e.before&&(u=e.before),void 0!==e.after&&"function"==typeof e.after&&(g=e.after))}function t(e,t,n,a){var o=$.extend({},a);return o.eventCategory=void 0!==t.data("ga-category")?t.data("ga-category"):n,o.eventAction=void 0!==t.data("ga-action")?t.data("ga-action"):e,void 0!==t.data("ga-label")&&(o.eventLabel=t.data("ga-label")),void 0!==t.data("ga-value")&&"number"==typeof t.data("ga-value")&&(o.eventValue=parseInt(t.data("ga-value"))),void 0!==t.data("ga-interactive")&&"boolean"==typeof t.data("ga-interactive")&&(o.nonInteraction=!t.data("ga-interactive")),o}function n(e,t){var n=$.Deferred();return s===!0&&""!=t.eventCategory&&""!=t.eventAction?$(t).each(function(a,o){var i=!0,r=ga.getAll()[0].get("name");"function"==typeof u&&(i=u(e,o)),"function"==typeof ga&&i===!0?(t.hitCallback=function(){if(p&&void 0!==window.console&&console.log("GA Event: ",t),h.length>0)for(var e=0,a=0;a<h.length;a++)h[a].hitCallback=function(){p&&void 0!==window.console&&console.log("Q GA Event: ",h[e]),e++,e===h.length&&(h.length=0,n.resolve(!0))},ga(r+".send",h[a]);else n.resolve(!0)},ga(r+".send",t)):n.resolve(!1)}):n.resolve(!1),n.promise()}function a(e){if(s===!0){var a=e.type,o=$(e.currentTarget),i=o[0].tagName,r=($(e.target),$.extend({},b)),v=[];y&&void 0===o.data("ga-event")?o.parents().each(function(e,t){var n=$(t);return $(t).is(l)===!1&&void 0!==n.data("ga-event")&&void 0===n.data("ga-no-track")?(n.trigger(a),!1):!$(t).is(l)&&void 0}):v=t(a,o,i,r);var c=!1;m===!0&&"a"===o[0].tagName.toLowerCase()&&""==o[0].target&&(e.preventDefault(),c=!0),n(e,v).done(function(t){"function"==typeof g&&g(e,t,v,h),c===!0&&(window.location=o[0].href)})}}function o(e,t){switch(t){case"click":v(e);break;case"enter":r(e)}}function i(e,t,a){var o=$(e)[0].checkValidity();o===!1&&(a.eventLabel="submission failed, form data is invalid"),n(t,a),o===!0&&e.submit()}function r(e){$(e).on("keydown",function(n){if(13===n.keyCode){n.preventDefault();var a=$(e).closest("form"),o=$.extend({},b);if(void 0!==i){var r=t("keydown",a,a[0].tagName,o);i(a,n,r)}}})}function v(e){$(e).on("click",function(n){var a=$(e).closest("form"),o=$.extend({},b);if(void 0!==i){var r=t("click",$(e),$(e)[0].tagName,o);i(a,n,r)}})}function c(e,t,n,i,r){if("function"==typeof window.ga&&void 0!==ga.create){void 0!==i&&"boolean"==typeof i&&(m=i),void 0!==r&&"boolean"==typeof r&&(p=r),l=e;var v=e.find("[data-ga-event]");void 0!==n&&"object"==typeof n&&(void 0!==n.before&&"function"==typeof n.before&&(u=n.before),void 0!==n.after&&"function"==typeof n.after&&(g=n.after)),void 0!==t&&"boolean"==typeof t&&(y=t),v.each(function(e,t){var n=$(t).data("ga-event").split(" ");$(n).each(function(e,n){var i=n.split(".");if(2===i.length)switch(i[0]){case"formsubmit":o(t,i[1])}else $(t).on($(t).data("ga-event"),function(e){a(e)})})})}else s=!1}function f(e){var t=$.extend({},b,e);if(""===t.eventCategory||""===t.eventAction)throw"Event options could not be added to the queue: Category and Action are mandatory.";h.push(t)}function d(e,t,a,o,i,r){var v=$.Deferred();if(s===!0&&"function"==typeof window.ga&&void 0!==ga.create){var c=$.extend({},b),f="",d={},l="";null!==e&&(f=e.type,d=$(e.target),l=d[0].tagName),c.eventCategory=void 0!==t?t:l,c.eventAction=void 0!==a?a:f,void 0!==o&&(c.eventLabel=o),void 0!==i&&"number"==typeof i&&(c.eventValue=parseInt(i)),void 0!==r&&"boolean"==typeof r&&(c.nonInteraction=!r),n(e,c).done(function(e){v.resolve(e)})}else v.resolve(!1);return v.promise()}var l,u,g,s=!0,y=!1,p=!1,b={hitType:"event",eventCategory:"",eventAction:"",nonInteraction:!1},h=[],m=!0;return{attachEventHandlers:c,queueEvent:f,trackEvent:d,attachCallbacks:e}};return e});