define(function(){var e=function(){function e(e,t,n,a){var o=$.extend({},a);return o.eventCategory=void 0!==t.data("ga-category")?t.data("ga-category"):n,o.eventAction=void 0!==t.data("ga-action")?t.data("ga-action"):e,void 0!==t.data("ga-label")&&(o.eventLabel=t.data("ga-label")),void 0!==t.data("ga-value")&&"number"==typeof t.data("ga-value")&&(o.eventValue=parseInt(t.data("ga-value"))),void 0!==t.data("ga-interactive")&&"boolean"==typeof t.data("ga-interactive")&&(o.nonInteraction=!t.data("ga-interactive")),o}function t(e,t){var n=$.Deferred();return g===!0&&""!=t.eventCategory&&""!=t.eventAction?$(t).each(function(a,o){var i=!0;"function"==typeof l&&(i=l(e,o)),"function"==typeof ga&&i===!0?(t.hitCallback=function(){if(y&&void 0!==window.console&&console.log("GA Event: ",t),b.length>0)for(var e=0,a=0;a<b.length;a++)b[a].hitCallback=function(){y&&void 0!==window.console&&console.log("Q GA Event: ",b[e]),e++,e===b.length&&(b.length=0,n.resolve(!0))},ga("send",b[a]);else n.resolve(!0)},ga("send",t)):n.resolve(!1)}):n.resolve(!1),n.promise()}function n(n){if(g===!0){var a=n.type,o=$(n.currentTarget),i=o[0].tagName,r=($(n.target),$.extend({},p)),v=[];s&&void 0===o.data("ga-event")?o.parents().each(function(e,t){var n=$(t);return $(t).is(f)===!1&&void 0!==n.data("ga-event")&&void 0===n.data("ga-no-track")?(n.trigger(a),!1):$(t).is(f)?!1:void 0}):v=e(a,o,i,r);var c=!1;n.preventDefault(),h===!0&&"a"===o[0].tagName.toLowerCase()&&""==o[0].target&&(c=!0),t(n,v).done(function(e){"function"==typeof u&&u(n,e,v,b),c===!0&&(window.location=o[0].href)})}}function a(e,t){switch(t){case"click":r(e);break;case"enter":i(e)}}function o(e,n,a){var o=$(e)[0].checkValidity();o===!1&&(a.eventLabel="submission failed, form data is invalid"),t(n,a),o===!0&&e.submit()}function i(t){$(t).on("keydown",function(n){if(13===n.keyCode){n.preventDefault();var a=$(t).closest("form"),i=$.extend({},p);if(void 0!==o){var r=e("keydown",a,a[0].tagName,i);o(a,n,r)}}})}function r(t){$(t).on("click",function(n){var a=$(t).closest("form"),i=$.extend({},p);if(void 0!==o){var r=e("click",$(t),$(t)[0].tagName,i);o(a,n,r)}})}function v(e,t,o,i,r){if("function"==typeof window.ga&&void 0!==ga.create){void 0!==i&&"boolean"==typeof i&&(h=i),void 0!==r&&"boolean"==typeof r&&(y=r),f=e;var v=e.find("[data-ga-event]");void 0!==o&&"object"==typeof o&&(void 0!==o.before&&"function"==typeof o.before&&(l=o.before),void 0!==o.after&&"function"==typeof o.after&&(u=o.after)),void 0!==t&&"boolean"==typeof t&&(s=t),v.each(function(e,t){var o=$(t).data("ga-event").split(" ");$(o).each(function(e,o){var i=o.split(".");if(2===i.length)switch(i[0]){case"formsubmit":a(t,i[1])}else $(t).on($(t).data("ga-event"),function(e){n(e)})})})}else g=!1}function c(e){var t=$.extend({},p,e);if(""===t.eventCategory||""===t.eventAction)throw"Event options could not be added to the queue: Category and Action are mandatory.";b.push(t)}function d(e,n,a,o,i,r){var v=$.Deferred();if(g===!0&&"function"==typeof window.ga&&void 0!==ga.create){var c=$.extend({},p),d="",f={},l="";null!==e&&(d=e.type,f=$(e.target),l=f[0].tagName),c.eventCategory=void 0!==n?n:l,c.eventAction=void 0!==a?a:d,void 0!==o&&(c.eventLabel=o),void 0!==i&&"number"==typeof i&&(c.eventValue=parseInt(i)),void 0!==r&&"boolean"==typeof r&&(c.nonInteraction=!r),t(e,c).done(function(e){v.resolve(e)})}else v.resolve(!1);return v.promise()}var f,l,u,g=!0,s=!1,y=!1,p={hitType:"event",eventCategory:"",eventAction:"",nonInteraction:!1},b=[],h=!0;return{attachEventHandlers:v,queueEvent:c,trackEvent:d}};return e});